generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_DIRECT_URL")
}

model User {
  id         String   @id @default(uuid())
  name       String
  email      String   @unique
  role       Role
  authId     String?  @unique
  password   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now())
  orders     Order[]  @relation("CustomerOrders")
  deliveries Order[]  @relation("RiderDeliveries")
  store      Store?   @relation("UserStore")
}

model Store {
  id        Int      @id @default(autoincrement())
  name      String
  location  String?
  ownerId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  foods     Food[]
  orders    Order[]
  owner     User     @relation("UserStore", fields: [ownerId], references: [id])
}

model Food {
  id         Int         @id @default(autoincrement())
  name       String
  price      Float
  storeId    Int
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @default(now())
  image      String?
  store      Store       @relation(fields: [storeId], references: [id])
  orderItems OrderItem[]
}

model Order {
  id          Int         @id @default(autoincrement())
  customerId  String
  storeId     Int
  riderId     String?
  status      OrderStatus @default(PENDING)
  totalPrice  Float       @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now())
  deliveredAt DateTime?
  customer    User        @relation("CustomerOrders", fields: [customerId], references: [id])
  rider       User?       @relation("RiderDeliveries", fields: [riderId], references: [id])
  store       Store       @relation(fields: [storeId], references: [id])
  items       OrderItem[]
  payment     Payment?    @relation("OrderPayment")
}

model OrderItem {
  id       Int   @id @default(autoincrement())
  orderId  Int
  foodId   Int
  quantity Int   @default(1)
  price    Float
  food     Food  @relation(fields: [foodId], references: [id])
  order    Order @relation(fields: [orderId], references: [id])
}

model Payment {
  id        Int           @id @default(autoincrement())
  orderId   Int           @unique
  method    PaymentMethod
  amount    Float
  status    PaymentStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now())
  order     Order         @relation("OrderPayment", fields: [orderId], references: [id])
}

enum Role {
  ADMIN
  STORE
  CUSTOMER
  RIDER
}

enum OrderStatus {
  PENDING
  ACCEPTED
  PREPARING
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

enum PaymentMethod {
  CASH
  CARD
  ONLINE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}
